---
title: "Data_analysis_project"
author: "James Hartner, Daniel Philipose, Daniel Lawall"
date: "11/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
```{r}
install.packages('stringr')

```

```{r}
library('tidyverse')
library('tidycensus')
library('janitor')
library('stringr')
```

## NOTES-James:

We need to surf all of these websites (possible scrapping) and identify any businesses owned by the senators and see if there are any people if some took out some loans (HINT: Sean found two (I think that's what he said, either two or three))

Here is some of the data cleaned. I felt that we didn't need many of these columns and this actually made my computer not crap out on me after a bit (this computer is absolute garbage. It's like a junk yard car, gets you from point A to point B. A couple hiccups from here and there but hey, it gets you there)

Also data from Sean. We can join these with the PPP data and go from there. 

```{r}
#Data from Sean 
senate_agreements <- read_rds("data/senate_agreements.rds")
senate_assets <-read_rds("data/senate_assets.rds")
senate_earned_income<-read_rds("data/senate_earned_income.rds")
senate_liabilities <-read_rds("data/senate_liabilities.rds")
senate_positions<-read_rds("data/senate_positions.rds")
senate_transactions <- read_rds("data/senate_transactions.rds")
senators_all<- read_rds("data/senators_all.rds")
```
```{r}
#ppp1<-read_csv("data/ppp1.csv")
ppp12 <- read_csv("data/PPP12.csv")
```
Possible Join Sean's data
```{r}
assets_LLC<-senate_assets %>%
  mutate(asset_type=str_detect(asset_type,"^Business")) %>%
  filter(asset_type=="TRUE") 
#Crapo Estate Holdings LLC Company: Crapo Estate Holding
  
crapo_senate <- assets_LLC %>%
  filter(str_detect(asset,"Crapo Estate"))

crapo_ppp <- ppp12 %>%
  filter(str_detect(BorrowerName,"^CRAPO"))

filtering_join_df <- crapo_senate %>%
  separate(asset, into=c("asset","junk"), sep=":") %>%
  #inner_join(crapo_ppp, by=c( "asset" = "BorrowerName"))
  stringdist_join(crapo_ppp, by=c("asset" = "BorrowerName"),max_dist=20)
#install.packages('fuzzyjoin')
#library(fuzzyjoin)

type <- senate_assets %>%
  group_by(asset_type) %>%
  count()

```
Cleaning Data
```{r}

cleaned_data12<-ppp12 %>%
  select(LoanNumber,BusinessType,DateApproved,BorrowerName,BorrowerAddress,BorrowerCity, BorrowerState, LoanStatus, InitialApprovalAmount, CurrentApprovalAmount, ForgivenessAmount) %>%
   mutate(BorrowerName=str_sub(BorrowerName)) %>%
  mutate(BorrowerName=tolower(BorrowerName))

```
LLC-filtering for all PPP. Usually a congressperson owns an LLC so we'll be looking at that. 
```{r}
#cleaned_data_LLC_1<-cleaned_data1 %>%
 # mutate(BorrowName=str_sub(BorrowerName)) %>%
  #mutate(BorrowerName=tolower(BorrowName)) %>%
#rename(senator_full_name=BorrowerName) %>%
 # filter(BusinessType=="Limited  Liability Company(LLC)") %>%
#drop_na(senator_full_name)

#All datasets keep going down from 1-12. 

cleaned_data_LLC_12<-cleaned_data12 %>%
rename(senator_full_name=BorrowerName) %>%
  filter(BusinessType=="Limited  Liability Company(LLC)") %>%
drop_na(senator_full_name)
```
Merging (based on LLC)
```{r}


```

Joining (more of thoughts, talk to Sean about this)
```{r}
senators_all %>%
  mutate(senator_full_name=str_sub(senator_full_name)) %>%
  mutate(senator_full_name=tolower(senator_full_name))

#We basically want to match the names of the senators, so we are trying to lowercase and take away the middle initials, so then we can merge by name

joined_data <- semi_join(cleaned_data_LLC_12,senators_all, by=c("senator_full_name"))
joined_data_test <- anti_join(cleaned_data_LLC_12,senators_all, by=c("senator_full_name"))




```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
